name: Publish
on:  
  push:
    tags:
      - '*'
  workflow_dispatch:
jobs:
  publish:
    name: Publish to pages
    runs-on: ubuntu-latest
    steps:
    - name: Set up Go
      uses: actions/setup-go@v5
      with:
        go-version: '1.24'

    - name: Check out code
      uses: actions/checkout@v4
      with:
        # preserve history to be able to see latest tag
        fetch-depth: 0

    - name: Install TinyGo
      uses: acifani/setup-tinygo@v2
      with:
        tinygo-version: '0.40.1'

    - name: Install Task
      uses: arduino/setup-task@v2
      with:
        version: 3.x
        repo-token: ${{ secrets.GITHUB_TOKEN }}

    - name: Run tests
      run: task test

    - name: Build pages
      run: task deploy-pages

    - name: Deploy ðŸš€
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        folder: build/gh-pages
        branch: gh-pages
